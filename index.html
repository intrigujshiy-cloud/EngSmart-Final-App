<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EngSmart 3.0 - Super Trainer Pro</title>
    <style>
        :root { --primary: #4a90e2; --bg-overlay: rgba(255,255,255,0.85); --card-bg: #ffffff; --card-border: #4a90e2; --card-neon: rgba(74, 144, 226, 0.5); }
        body, html { margin:0; padding:0; height:100vh; font-family: 'Comic Sans MS', cursive, sans-serif; overflow: hidden; }
        
        /* –°—Ç–∏–ª–∏ –†–µ–¥–∞–∫—Ç–æ—Ä–∞ */
        #setup-screen {
            position: fixed; inset: 0; background: #f0f4f8; z-index: 1000;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .setup-panel {
            background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%; max-width: 850px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; max-height: 90vh;
        }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .color-inputs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 12px; }
        .color-field { display: flex; flex-direction: column; align-items: center; font-size: 12px; gap: 5px; }
        
        /* –ü–æ–ª—è —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        textarea { height: 150px; padding: 10px; border: 2px solid #ddd; border-radius: 10px; resize: none; font-family: monospace; width: 100%; box-sizing: border-box; color: #999; }
        
        .btn-start { background: #2ecc71; color: white; border: none; padding: 15px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 18px; transition: 0.3s; margin-top: 10px; }
        .btn-iframe { background: #4a90e2; color: white; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 14px; }
        #iframeResult { background: #eee; padding: 10px; font-family: monospace; font-size: 11px; word-break: break-all; border-radius: 8px; display: none; }

        /* –°—Ç–∏–ª–∏ –ò–≥—Ä—ã */
        #game-screen { display: none; height: 100vh; flex-direction: column; background-size: cover; background-position: center; }
        .overlay { position: absolute; inset: 0; background: var(--bg-overlay); backdrop-filter: blur(5px); display: flex; flex-direction: column; }
        .header { height: 60px; display: flex; justify-content: center; align-items: center; gap: 15px; background: white; z-index: 10; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .dot { width: 12px; height: 12px; border-radius: 50%; background: #ddd; transition: 0.5s; }
        .dot.active { background: var(--primary); transform: scale(1.3); }
        .content { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-wrap: wrap; justify-content: center; align-content: flex-start; gap: 20px; }
        
        .card { width: 150px; height: 200px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: 0.6s; transform-style: preserve-3d; }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-face { 
            position: absolute; inset: 0; backface-visibility: hidden; 
            background: var(--card-bg); 
            border: 3px solid var(--card-border); 
            border-radius: 15px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; text-align: center;
            box-shadow: 0 0 15px var(--card-neon);
            color: #000000 !important; /* –¢–ï–ö–°–¢ –í–°–ï–ì–î–ê –ß–ï–†–ù–´–ô */
        }
        .card-back { transform: rotateY(180deg); font-size: 20px; font-weight: bold; color: #000000 !important; }
        .card img { max-width: 80%; max-height: 80px; margin-bottom: 10px; }

        .match-item { padding: 12px; background: var(--card-bg); border: 3px solid var(--card-border); border-radius: 12px; cursor: pointer; width: 45%; font-weight: bold; text-align: center; margin-bottom: 10px; box-shadow: 0 0 10px var(--card-neon); color: #000000 !important; }
        .match-item.selected { background: var(--card-border); color: white !important; }
        .match-item.hidden { opacity: 0; pointer-events: none; }

        .footer { height: 80px; display: flex; justify-content: center; align-items: center; }
        .next-btn { padding: 12px 35px; background: var(--primary); color: white; border: none; border-radius: 50px; font-size: 16px; font-weight: bold; cursor: pointer; }
        #victory { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <div class="setup-panel">
            <h2 style="margin:0; color: #4a90e2; text-align: center;">EngSmart 3.0 Designer</h2>
            
            <div class="grid-inputs">
                <div><label>1. English</label><textarea id="enList" placeholder="apple&#10;cat..."></textarea></div>
                <div><label>2. Russian</label><textarea id="ruList" placeholder="—è–±–ª–æ–∫–æ&#10;–∫–æ—Ç..."></textarea></div>
                <div><label>3. Images (URLs)</label><textarea id="imgList" placeholder="https://..."></textarea></div>
            </div>

            <div class="color-inputs">
                <div class="color-field"><label>–†–∞–º–∫–∞</label><input type="color" id="colorBorder" value="#4a90e2"></div>
                <div class="color-field"><label>–§–æ–Ω –∫–∞—Ä—Ç</label><input type="color" id="colorBg" value="#ffffff"></div>
                <div class="color-field"><label>–ù–µ–æ–Ω</label><input type="color" id="colorNeon" value="#4a90e2"></div>
            </div>

            <label>–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</label>
            <input type="text" id="bgInput" value="https://images.unsplash.com/photo-1518709268805-4e9042af9f23" style="padding:10px; border-radius:8px; border:2px solid #ddd;">
            
            <button class="btn-start" onclick="startGame()">–ó–ê–ü–£–°–¢–ò–¢–¨ –¢–†–ï–ù–ê–ñ–ï–† üöÄ</button>
            <button class="btn-iframe" onclick="generateIframe()">–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY üîó</button>
            <div id="iframeResult"></div>
        </div>
    </div>

    <div id="game-screen">
        <div class="overlay">
            <div class="header">
                <div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div><div class="dot" id="d4"></div>
            </div>
            <div id="content" class="content"></div>
            <div class="footer">
                <button id="nextBtn" class="next-btn" onclick="nextLevel()">NEXT ‚Üí</button>
            </div>
        </div>
    </div>

    <div id="victory">
        <h1 style="font-size: 50px; color: #f1c40f;">SUPERHERO! ü¶∏‚Äç‚ôÇÔ∏è</h1>
        <button class="next-btn" onclick="location.reload()">REPLAY</button>
    </div>

    <script>
        let words = [];
        let level = 1;
        let matchSelected = { en: null, ru: null };
        let currentIdx = 0;

        function updateStyles() {
            const root = document.documentElement;
            root.style.setProperty('--card-border', document.getElementById('colorBorder').value);
            root.style.setProperty('--card-bg', document.getElementById('colorBg').value);
            root.style.setProperty('--card-neon', hexToRgbA(document.getElementById('colorNeon').value));
        }

        function hexToRgbA(hex){
            let c;
            if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)){
                c= hex.substring(1).split('');
                if(c.length== 3) c= [c[0], c[0], c[1], c[1], c[2], c[2]];
                c= '0x'+c.join('');
                return 'rgba('+[(c>>16)&255, (c>>8)&255, c&255].join(',')+',0.5)';
            }
            return 'rgba(74, 144, 226, 0.5)';
        }

        function generateIframe() {
            const en = encodeURIComponent(document.getElementById('enList').value.split('\n').join(','));
            const ru = encodeURIComponent(document.getElementById('ruList').value.split('\n').join(','));
            const im = encodeURIComponent(document.getElementById('imgList').value.split('\n').join(','));
            const bg = encodeURIComponent(document.getElementById('bgInput').value);
            const cb = encodeURIComponent(document.getElementById('colorBorder').value);
            const cg = encodeURIComponent(document.getElementById('colorBg').value);
            const cn = encodeURIComponent(document.getElementById('colorNeon').value);
            
            const gameUrl = `${window.location.href.split('?')[0]}?play=true&en=${en}&ru=${ru}&im=${im}&bg=${bg}&cb=${cb}&cg=${cg}&cn=${cn}`;
            document.getElementById('iframeResult').innerText = `<iframe src="${gameUrl}" width="800" height="600" style="border:0;" allowfullscreen></iframe>`;
            document.getElementById('iframeResult').style.display = 'block';
        }

        function startGame() {
            updateStyles();
            const en = document.getElementById('enList').value.split('\n');
            const ru = document.getElementById('ruList').value.split('\n');
            const im = document.getElementById('imgList').value.split('\n');
            words = en.map((word, i) => ({ en: word.trim(), ru: (ru[i] || "").trim(), im: (im[i] || "").trim() })).filter(w => w.en && w.ru);
            document.getElementById('game-screen').style.backgroundImage = `url(${document.getElementById('bgInput').value})`;
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            renderLevel();
        }

        function renderLevel() {
            const cont = document.getElementById('content'); cont.innerHTML = '';
            document.querySelectorAll('.dot').forEach((d, i) => d.className = (i+1 === level) ? 'dot active' : 'dot');
            document.getElementById('nextBtn').style.display = 'block';

            if(level === 1) {
                words.forEach(w => {
                    const card = document.createElement('div'); card.className = 'card';
                    card.innerHTML = `<div class="card-inner"><div class="card-face"><img src="${w.im}"><div>${w.en}</div></div><div class="card-face card-back">${w.ru}</div></div>`;
                    card.onclick = () => { card.classList.toggle('flipped'); if(card.classList.contains('flipped')) speak(w.en); };
                    cont.appendChild(card);
                });
            } else if(level === 2) {
                document.getElementById('nextBtn').style.display = 'none';
                const enL = [...words].sort(() => Math.random()-0.5), ruL = [...words].sort(() => Math.random()-0.5);
                const cEn = document.createElement('div'), cRu = document.createElement('div');
                cEn.style.width=cRu.style.width='45%';
                enL.forEach(w => { const b = document.createElement('div'); b.className = 'match-item'; b.innerText = w.en; b.onclick = () => { speak(w.en); handleMatch(w.en, 'en', b); }; cEn.appendChild(b); });
                ruL.forEach(w => { const b = document.createElement('div'); b.className = 'match-item'; b.innerText = w.ru; b.onclick = () => handleMatch(w.en, 'ru', b); cRu.appendChild(b); });
                cont.append(cEn, cRu);
            } else if(level === 3) {
                document.getElementById('nextBtn').style.display = 'none';
                const w = words[currentIdx]; let curS = "";
                let lets = w.en.split('').sort(() => Math.random()-0.5);
                cont.innerHTML = `<div style="text-align:center;width:100%"><img src="${w.im}" style="width:120px"><div id="az" style="min-height:40px;border-bottom:3px dashed var(--primary);margin:20px;font-size:30px;color:var(--primary)"></div><div id="lz"></div></div>`;
                lets.forEach(l => {
                    const s = document.createElement('div'); s.className = 'match-item'; s.style.display='inline-block'; s.style.width='auto'; s.style.margin='5px'; s.innerText = l;
                    s.onclick = () => { curS += l; document.getElementById('az').innerText = curS; s.style.visibility = "hidden";
                        if(curS.toLowerCase() === w.en.toLowerCase()) { speak(w.en); setTimeout(() => { currentIdx++; if(currentIdx < words.length) renderLevel(); else { currentIdx=0; document.getElementById('nextBtn').style.display='block'; } }, 600); }
                        else if (curS.length >= w.en.length) setTimeout(() => renderLevel(), 600);
                    };
                    cont.querySelector('#lz').appendChild(s);
                });
            } else if(level === 4) {
                document.getElementById('nextBtn').style.display = 'none';
                const w = words[currentIdx];
                cont.innerHTML = `<div style="background:var(--card-bg);padding:20px;border-radius:20px;border:5px solid var(--card-border);text-align:center;width:280px;margin:auto;box-shadow:0 0 20px var(--card-neon)"><img src="${w.im}" style="width:100px"><h3 style="color:#000">${w.ru}</h3><input type="text" id="wi" style="width:100%;font-size:24px;text-align:center;border:none;border-bottom:3px solid #ddd;outline:none;text-transform:uppercase;color:#000"></div>`;
                const inp = document.getElementById('wi'); inp.focus();
                inp.oninput = () => {
                    if(inp.value.toLowerCase() === w.en.toLowerCase()) { speak(w.en); setTimeout(() => { currentIdx++; if(currentIdx < words.length) renderLevel(); else document.getElementById('victory').style.display = 'flex'; }, 500); }
                };
            }
        }

        function speak(t) { const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; speechSynthesis.speak(m); }
        function handleMatch(v, t, b) {
            if(matchSelected[t]) matchSelected[t].btn.classList.remove('selected');
            matchSelected[t] = { v, btn: b }; b.classList.add('selected');
            if(matchSelected.en && matchSelected.ru) {
                if(matchSelected.en.v === matchSelected.ru.v) { matchSelected.en.btn.classList.add('hidden'); matchSelected.ru.btn.classList.add('hidden'); matchSelected = { en: null, ru: null }; if(document.querySelectorAll('.match-item:not(.hidden)').length === 0) document.getElementById('nextBtn').style.display = 'block'; }
                else { setTimeout(() => { matchSelected.en.btn.classList.remove('selected'); matchSelected.ru.btn.classList.remove('selected'); matchSelected = { en: null, ru: null }; }, 400); }
            }
        }
        function nextLevel() { level++; currentIdx = 0; renderLevel(); }

        const ps = new URLSearchParams(window.location.search);
        if(ps.has('play')) {
            document.body.onload = () => {
                document.getElementById('colorBorder').value = ps.get('cb');
                document.getElementById('colorBg').value = ps.get('cg');
                document.getElementById('colorNeon').value = ps.get('cn');
                updateStyles();
                const en = ps.get('en').split(','), ru = ps.get('ru').split(','), im = ps.get('im').split(',');
                words = en.map((w, i) => ({ en: w, ru: ru[i], im: im[i] }));
                document.getElementById('game-screen').style.backgroundImage = `url(${ps.get('bg')})`;
                document.getElementById('setup-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                renderLevel();
            }
        }
    </script>
</body>
</html>
