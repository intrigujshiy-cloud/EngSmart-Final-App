<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EngSmart 4.2 Pro - Full Engine</title>
    <style>
        /* –°–¢–ò–õ–¨ –†–ï–î–ê–ö–¢–û–†–ê */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f9; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .constructor { width: 100%; max-width: 900px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-top: 40px; }
        .section { background: #fff; border: 1px solid #edf2f7; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .section-title { font-size: 0.75rem; font-weight: bold; color: #718096; text-transform: uppercase; margin-bottom: 10px; }
        textarea, input { width: 100%; padding: 10px; border: 2px solid #edf2f7; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .btn-group { display: flex; gap: 15px; justify-content: center; margin: 20px 0; }
        .btn { padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-gen { background: #2ecc71; color: white; }
        .btn-test { background: #5d9cec; color: white; }
        .output-area { background: #2d3748; color: #a0aec0; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.85rem; word-break: break-all; }

        /* –°–¢–ò–õ–¨ –ò–ì–†–´ */
        #game-view { display: none; width: 100vw; height: 100vh; background-size: cover; background-position: center; flex-direction: column; align-items: center; justify-content: center; position: fixed; top:0; left:0; }
        .card-container { perspective: 1000px; width: 320px; height: 420px; cursor: pointer; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px; background: white; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center; }
        .card-back { transform: rotateY(180deg); background: #fdfdfd; }
        .card-img { max-width: 90%; max-height: 200px; border-radius: 10px; margin-bottom: 15px; }
        .word { font-size: 28px; font-weight: bold; color: #333; }
        .level-badge { position: absolute; top: 20px; background: rgba(0,0,0,0.5); color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; }
        .nav-btn { margin-top: 25px; background: white; color: #333; padding: 10px 40px; border-radius: 50px; font-size: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div id="editor-view" class="constructor">
        <h1 style="color: #4a90e2; text-align: center; margin-top:0;">EngSmart 4.2 Pro</h1>
        <div class="section">
            <div class="section-title">1. Global Background (URL)</div>
            <input type="text" id="bgInp" value="https://images.unsplash.com/photo-1518709268805-4e9042af9f23">
        </div>
        <div class="grid">
            <div class="section"><div class="section-title">2. English</div><textarea id="enInp" rows="6">Apple&#10;Banana&#10;Cat</textarea></div>
            <div class="section"><div class="section-title">3. Russian</div><textarea id="ruInp" rows="6">–Ø–±–ª–æ–∫–æ&#10;–ë–∞–Ω–∞–Ω&#10;–ö–æ—Ç</textarea></div>
            <div class="section"><div class="section-title">4. Images</div><textarea id="imgInp" rows="6">https://cdn-icons-png.flaticon.com/512/415/415733.png&#10;https://cdn-icons-png.flaticon.com/512/2909/2909808.png&#10;https://cdn-icons-png.flaticon.com/512/616/616430.png</textarea></div>
        </div>
        <div class="btn-group">
            <button class="btn btn-gen" onclick="generate()">üöÄ Get iFrame Code</button>
            <button class="btn btn-test" onclick="preview()">üëÅÔ∏è Test Game</button>
        </div>
        <div class="section">
            <div class="section-title">Your Code for Genially:</div>
            <div id="result" class="output-area">–ö–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
        </div>
    </div>

    <div id="game-view">
        <div id="level-info" class="level-badge">Level 1: Eng + Pic ‚Üí Ru</div>
        <div class="card-container" onclick="flipCard()">
            <div id="main-card" class="card">
                <div class="card-face card-front">
                    <img id="front-img" class="card-img" src="">
                    <div id="front-text" class="word"></div>
                </div>
                <div class="card-face card-back">
                    <div id="back-text" class="word"></div>
                </div>
            </div>
        </div>
        <button class="btn nav-btn" onclick="nextCard()">NEXT ‚ûî</button>
    </div>

    <script>
        let currentIndex = 0;
        let currentLevel = 1;
        let wordsData = [];

        function generate() {
            const bg = encodeURIComponent(document.getElementById('bgInp').value);
            const en = encodeURIComponent(document.getElementById('enInp').value.split('\n').join(','));
            const ru = encodeURIComponent(document.getElementById('ruInp').value.split('\n').join(','));
            const img = encodeURIComponent(document.getElementById('imgInp').value.split('\n').join(','));
            const currentUrl = window.location.href.split('?')[0];
            const finalUrl = `${currentUrl}?play=true&bg=${bg}&en=${en}&ru=${ru}&img=${img}`;
            const iframe = `<iframe src="${finalUrl}" width="800" height="600" style="border:0; border-radius:20px;" allowfullscreen></iframe>`;
            document.getElementById('result').innerText = iframe;
        }

        function preview() {
            const code = document.getElementById('result').innerText;
            if (code.includes('<iframe')) {
                const url = code.match(/src="([^"]+)"/)[1];
                window.open(url, "_blank");
            } else { alert("–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–æ–¥!"); }
        }

        function flipCard() { document.getElementById('main-card').classList.toggle('flipped'); }

        function updateCard() {
            const card = wordsData[currentIndex];
            const cardEl = document.getElementById('main-card');
            cardEl.classList.remove('flipped');
            
            const frontText = document.getElementById('front-text');
            const backText = document.getElementById('back-text');
            const frontImg = document.getElementById('front-img');
            const levelInfo = document.getElementById('level-info');

            if (currentLevel === 1) {
                levelInfo.innerText = "Level 1: English ‚Üí Russian";
                frontText.innerText = card.en;
                frontImg.src = card.img; frontImg.style.display = 'block';
                backText.innerText = card.ru;
            } else if (currentLevel === 2) {
                levelInfo.innerText = "Level 2: Russian ‚Üí English";
                frontText.innerText = card.ru;
                frontImg.style.display = 'none';
                backText.innerText = card.en;
            } else if (currentLevel === 3) {
                levelInfo.innerText = "Level 3: Image ‚Üí English";
                frontText.innerText = "";
                frontImg.src = card.img; frontImg.style.display = 'block';
                backText.innerText = card.en;
            }
        }

        function nextCard() {
            currentIndex++;
            if (currentIndex >= wordsData.length) {
                currentIndex = 0;
                currentLevel++;
                if (currentLevel > 3) currentLevel = 1;
            }
            updateCard();
        }

        // –ó–ê–ü–£–°–ö –ò–ì–†–´ –ò–ó –ü–ê–†–ê–ú–ï–¢–†–û–í
        const params = new URLSearchParams(window.location.search);
        if (params.has('play')) {
            document.getElementById('editor-view').style.display = 'none';
            document.getElementById('game-view').style.display = 'flex';
            document.getElementById('game-view').style.backgroundImage = `url('${decodeURIComponent(params.get('bg'))}')`;
            
            const enList = decodeURIComponent(params.get('en')).split(',');
            const ruList = decodeURIComponent(params.get('ru')).split(',');
            const imgList = decodeURIComponent(params.get('img')).split(',');

            wordsData = enList.map((en, i) => ({ en, ru: ruList[i], img: imgList[i] }));
            updateCard();
        }
    </script>
</body>
</html>
